#!/usr/bin/env python3
from argparse import ArgumentParser

import dearpygui.dearpygui as dpg

from siebenapp.system import load, split_long
from siebenapp.render import Renderer

dpg.create_context()
dpg.create_viewport(title="SiebenApp")
dpg.setup_dearpygui()

parser = ArgumentParser()
parser.add_argument(
    "db",
    nargs="?",
    default="sieben.db",
    help="Path to the database file (default: sieben.db)",
)
args = parser.parse_args()
goaltree = load(args.db)
render_result = Renderer(goaltree).build()

with dpg.window(tag="primary"):
    with dpg.node_editor(callback=lambda x, y: None, delink_callback=lambda x, y: None):
        for goal_id, attrs in render_result.graph.items():
            if isinstance(goal_id, str):
                continue
            label = split_long(attrs["name"])
            pos = [100 + attrs["col1"] * 300, attrs["row"] * 120]
            with dpg.node(label=label, pos=pos):
                pass

dpg.show_viewport()
dpg.set_primary_window("primary", True)
dpg.start_dearpygui()
dpg.destroy_context()
